/*
$ gcc -o stack7 -fno-stack-protector -z execstack -z norelro -no-pie stack7.c -Wno-implicit-function-declaration
/usr/bin/ld: /tmp/cckmz1QA.o: in function `getpath':
stack7.c:(.text+0x30): warning: the `gets' function is dangerous and should not be used.
*/

#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

char *getpath()
{
  char buffer[64];
  unsigned int ret;

  printf("input path please: ");
  fflush(stdout);

  gets(buffer);

  ret = (unsigned int)__builtin_return_address(0);

  if ((ret & 0xb0000000) == 0xb0000000)
  {
    printf("bzzzt (%p)\n", ret);
    _exit(1);
  }

  printf("got path %s\n", buffer);
  return strdup(buffer);
}

int main(int argc, char **argv)
{
  getpath();
}
